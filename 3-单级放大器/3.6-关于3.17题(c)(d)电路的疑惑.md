---
title: 关于3.17题电路的纠错与分析
---

$$
\begin{align*}
\newcommand{\dif}{\mathop{}\!\mathrm{d}}
\newcommand{\tx}{\text}
\newcommand{\p}{\partial\,}
\end{align*}
$$

## 原题

3.17 Sketch $V_\tx{out}$ versus $V_\tx{in}$ for the circuits of Fig. 3.80 as $V_\tx{in}$ varies from 0 to $V_\tx{DD}$. Identify important transition points.（a,b 很简单，关键是 c,d 有点问题）

![Figure 3.80](images/Figure%203.80.jpg)
## 答案

![屏幕截图 2021-06-14 231847](https://i.loli.net/2021/06/14/YiFXSuBIZhr3sMa.jpg)

关于 (d) 中的 $V_\tx{out}$ 那个值的求解：

$$
(W/L)_2 (V_{b1}-V_\tx{out}-V_\tx{TH1})^2 = (W/L)_1 (V_{b2}-V_\tx{TH2})^2\\
解得：V_\tx{out} = (V_{b1}-V_\tx{TH1})-\sqrt{\frac{(W/L)_1}{(W/L)_2}}(V_{b2}-V_\tx{TH2})
$$

## 仿真

![IMG_1402(20210328-175508)](images/屏幕截图%202021-06-14%20222706.jpg)
* 工艺：Chrt35rf
* M1、M2、M3 W/L = 1u/350n

## 分析

&emsp;&emsp;我们设 (c) 中输出为 $V_X$，(d) 中输出为 $V_Y$（对应仿真中的 X、Y 端口）<br>

&emsp;&emsp;不妨先考虑三个管子均饱和的情况，根据答案，应该对应 $Y$ 曲线水平部分。此时，若减小 $V_\tx{in}$（增大 $\vert V_{GS3} \vert$），根据 $I_{D3}=\frac{1}{2}K_p(W/L) (V_{GS3}-V_\tx{TH3})^2$，$I_D$ 会变大。但注意到仿真中，电流也是水平不变的，这就产生了矛盾，说明有两种可能：

1. 可能要考虑 $M_3$ 的沟道长度调制效应，即：$I_{D3}=\frac{1}{2}K_p(W/L) (V_{GS3}-V_\tx{TH3})^2(1-\lambda V_{DS3})$
2. 可能此处并非 $M_3$ 饱和，而是在线性区，即：$I_{D3}=K_p (W/L)[(V_{GS3}-V_\tx{TH})V_{DS3}-\frac{1}{2}V_{DS3}^2]$

&emsp;&emsp;观察此时 $V_X$ 的电压，当 $V_\tx{in}=3.3V$ 时，$V_X\approx 3.9V$，我们几乎可以认为 $\vert V_{GD3}\vert \geq \vert V_\tx{TH3} \vert$，即 $M_3$ 应该处于线性区。为了进一步验证这个结论，我们可以作出理论上的 $V_X$ 曲线：下图绿线对应线性区，灰线对应饱和区。注意到绿线和仿真曲线（紫色那条）几乎拟合，这基本上可以证明 $M_3$ 确实是在线性区（而非答案所说的饱和区）

![屏幕截图 2021-06-15 110115](images/屏幕截图%202021-06-15%20110115.jpg)

&emsp;&emsp;那么，$M_3$ 饱和区在哪呢？个人认为，应该对应仿真图中，$V_X,V_Y$ 不重合那一段（$V_\tx{in}=3.3\sim 3.6 \tx{V}$），此时 $V_X$ 相当于 $M_3$ 的共源输出，并且 $M_2$ 同样饱和，所以共源增益应该比较大。而 $V_Y$ 由于受到 $M_2$ 的屏蔽，电压变化幅度不如 $V_X$

&emsp;&emsp;当 $M_2$ 进入线性区后，$V_Y$ 失去的屏蔽，故 $V_Y,V_X$ 相近，两曲线几乎重合。不过所幸 $M_1$ 依然是饱和，所以 $M_3$ 的共源增益依然较大，曲线的斜率依然较大。

&emsp;&emsp;当 $M_1$ 进入线性区后，$M_3$ 的共源增益减小，曲线斜率逐渐下降，直到 $M_3$ 关闭，斜率归零。

&emsp;&emsp;最终我认为应该是下图这样：

![屏幕截图 2021-06-15 111639](images/屏幕截图%202021-06-15%20111639.jpg)

&emsp;&emsp;补充：三管均饱和时，$V_\tx{in}$ 变化会导致电流 $I_{D}$ 变化，但 $V_{GS1}$ 却是固定的，如果不考虑 $M_1$ 的沟道长度调制效应，那么 $I_{D1}$ 不会变，这两者不是矛盾了吗？也就是说我们应该考虑 $M_1$ 的沟道长度调制效应（同理，$M_2$ 也要考虑）原答案没有考虑这点，所以出错了。

<!--
&emsp;&emsp;那么饱和区到底在哪呢？此时考虑 $M_1$，由于 $V_{GS1}$ 是固定的，所以如果不考虑沟道长度调制效应，$I_{D1}$ 不会变，这就产生了矛盾。故根据 $I_{D1}=\frac{1}{2}K_n(W/L) (V_{GS1}-V_\tx{TH1})^2(1+\lambda V_{DS1})$，$V_{DS1}$ 应该变大，即 $V_Y$ 应该变大，并且 $V_Y$ 与 $V_\tx{in}$ 之间应该为 2 次关系（开口向上）。$M_2$ 的情况与 $M_1$ 类似，但由于 $V_Y$ 上升导致 $V_{GS2}$ 变小，所以要使 $I_{D2}$ 同等变大，那么 $V_{DS2}$ 增大的幅度也应该更大（对应图中两线分离的部分）。<br>

&emsp;&emsp;然后考虑左边的情况，随着 $V_\tx{in}$ 减小且 $V_X$ 增大，$M_3$ 会进入 Triode，这么一来，$I_{D3}=K_p (W/L)[(V_{GS3}-V_\tx{TH})V_{DS3}-\frac{1}{2}V_{DS3}^2]$，注意到 $V_{GS3}$ 变大的同时 $V_X$ 会变大（$V_{DS3}$ 变小），这两者的作用会相互抵消，导致 $I_{D3}$ 几乎不变，从而 $V_{DS2},V_{DS1}$ 也几乎不变（对应图中下面的曲线平的那一段）<br>

&emsp;&emsp;（关于上一段的进一步解释。首先，既然 $I_D$ 不变，那么 $M_1,M_2$ 三端的电压也应该不变，否则电流就会变，但我们注意到图像中 $V_X$ 却会变大，这显然是矛盾的，唯一的解释就是此时不需要管 $M_2$ 的沟道长度调制效应了。另一个矛盾点是，我们易知：$\dfrac{\p I_{D3}}{\p V_{GS3}}=V_{DS}$，但图像中 $I_{D3}$ 并不随 $V_{GS3}$ 变化，所以这应该是 0，但显然 $V_{DS}\neq 0$😱，这点我实在解释不了……）<br>
-->
